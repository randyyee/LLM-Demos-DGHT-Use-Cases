{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 42,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "from dotenv import load_dotenv\n",
    "import json\n",
    "import requests\n",
    "import time\n",
    "from openai import AzureOpenAI\n",
    "import pandas as pd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "client = AzureOpenAI(\n",
    "  azure_endpoint = \"\",\n",
    "  api_key= \"\",\n",
    "  api_version=\"\"\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "assistant = client.beta.assistants.create(\n",
    "  model=\"\", # replace with model deployment name.\n",
    "  instructions=\"\"\"Classify the tone of a given written entry as positive, negative, mixed, or neutral. Exclude phrases that are related to regular duties unless they indicate a strategic change and its impact. Exclude any phrases that are plans for the future.  Exclude any phrases that only describe current efforts without mentioning impact/outcomes. Provide reasoning, supporting quotes, a score based on the number of positive/negative phrases, and tags for your classification.\n",
    "\n",
    "# Steps\n",
    "\n",
    "1. **Read the Entry**: Carefully examine the given text to understand the context, content, and overall message.\n",
    "2. **Identify Relevant Sections**: Exclude sentences that are part of regular duties unless they showcase a strategic change and its impact. Exclude any phrases that are plans for the future.  Exclude any phrases that only describe current efforts without mentioning impact/outcomes\n",
    "3. **Determine the Tone**: Analyze the remaining content to determine whether the tone is positive, negative, mixed, or neutral.\n",
    "4. **Provide Reasoning**: Explain the rationale for your classification based on the content and tone of the relevant sections.\n",
    "5. **Support with Quotes**: Include specific quotes from the text that support your classification decision.\n",
    "6. **Score**: Add 1 for every positive phrase, -1 for every negative phrase, and 0 for all else. Report the final score.\n",
    "7. **Components**: # of positive, # of negative, # of mixed, # of neutral\n",
    "8. **Provide tag(s)**: Include tag(s) describing the general subject of the narrative (example, \"Data quality challenges, drug stockouts, healthcare statistics, etc.)\n",
    "\n",
    "# Output Format\n",
    "\n",
    "Provide a brief paragraph including:\n",
    "- Tone classification (positive, negative, mixed, or neutral).\n",
    "- Reasoning for the classification decision.\n",
    "- Supporting quotes from the text.\n",
    "- Score\n",
    "- Components\n",
    "- Tag(s): recommend tags representing the general topic of the narrative (ex. data quality issues, resource issues\n",
    "\n",
    "# Examples\n",
    "\n",
    "**Example 1:**\n",
    "\n",
    "Input: \"FMOH ART register/EMR_ART patient level database is the primary data source. This indicator is collected monthly from ART register/ EMR_ART database at health facilities. ICAP collects data directly from the source using standard reporting forms that include all required disaggregation for age. Data is entered into ICAP DSS database where logic checks and data validations are conducted to ensure completeness, consistency, and logic. Site support visits to all ICAP-supported facilities include spot checking of data to ensure completeness and accuracy, and mentorship is provided on data quality. No challenges in reporting this indicator were encountered and there are no data quality issues to report.\"\n",
    "\n",
    "Output: \n",
    "```\n",
    "- Classification: Positive\n",
    "- Reasoning: The text describes the quality and accuracy of the data system.\n",
    "- Supporting Quotes: \"No challenges in reporting this indicator were encountered and there are no data quality issues to report\"\n",
    "- Score: 2\n",
    "- Components: 2 positive, 5 neutral\n",
    "- Tag(s): Data quality\n",
    "```\n",
    "\n",
    "**Example 2:**\n",
    "\n",
    "Input: \"We saw an increase in patients returning for treatment. But the EMR encountered unexpected downtimes, affecting performance.\"\n",
    "\n",
    "Output: \n",
    "```\n",
    "- Classification: Mixed\n",
    "- Reasoning: The text contains elements of both successful patient outcomes and unexpected issues that caused concern.\n",
    "- Supporting Quotes: \"increase in patients returning\", \"Routine checks were performed,\" \"encountered unexpected downtimes, affecting performance.\"\n",
    "- Score: 0 \n",
    "- Components: 1 positive, 1 negative phrase\n",
    "- Tag(s): Data quality, patient return\n",
    "```\n",
    "\n",
    "**Example 3:**\n",
    "\n",
    "Input: \"A total of 2492 clients were initiated on PrEP in Q3.\"\n",
    "\n",
    "Output:\n",
    "```\n",
    "-Classification: Neutral\n",
    "- Reasoning: The text provides a factual update on the number of clients initiated on PrEP and the project's achievement percentage, without any qualitative assessment or indication of impact beyond the figures.\n",
    "- Supporting Quotes: \"A total of 2492 clients were initiated on PrEP in Q3.\" \"Bring the project achievement to 74% (6,440/8712).\"\n",
    "- Score: 0\n",
    "- Components: 2 neutral\n",
    "- Tag(s): Health statistics\n",
    "``` \n",
    "\n",
    "\n",
    "# Notes\n",
    "\n",
    "- Ensure to separate regular duties from strategic changes or impactful events.\n",
    "- Exclude any phrases that are plans for the future as they have not happened yet.\n",
    "- Exclude any phrases that only describe current efforts without mentioning impact/outcomes. \n",
    "- Mixed tones should be noted when positive and negative elements coexist in significance.\n",
    "- If the narrative uses the word achievement and reports a percentage, evaluate >= 100% as positive, and low achievement as negative. If the achievement is close to 100% (use your discretion to figure out how close is good enough), evaluate as positive\n",
    "\"\"\",\n",
    "  tools=[],\n",
    "  tool_resources={},\n",
    "  temperature=0.01,\n",
    "  top_p=1\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Unnamed: 0</th>\n",
       "      <th>Operating Unit</th>\n",
       "      <th>Org Level</th>\n",
       "      <th>Country</th>\n",
       "      <th>Indicator Bundle</th>\n",
       "      <th>Indicator</th>\n",
       "      <th>Support Type</th>\n",
       "      <th>Funding Agency</th>\n",
       "      <th>Mechanism Code</th>\n",
       "      <th>Implementing Mechanism Name</th>\n",
       "      <th>Period</th>\n",
       "      <th>Narrative</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Operating Unit</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Health Systems</td>\n",
       "      <td>CARE_CURR</td>\n",
       "      <td>TA</td>\n",
       "      <td>DOD</td>\n",
       "      <td>17397.0</td>\n",
       "      <td>CDU  Angola</td>\n",
       "      <td>2015 Q2</td>\n",
       "      <td>The FAA have not authorized sharing their care...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Operating Unit</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Health Systems</td>\n",
       "      <td>CARE_NEW</td>\n",
       "      <td>TA</td>\n",
       "      <td>DOD</td>\n",
       "      <td>17397.0</td>\n",
       "      <td>CDU  Angola</td>\n",
       "      <td>2015 Q2</td>\n",
       "      <td>The FAA have not authorized sharing their care...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Operating Unit</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Prevention</td>\n",
       "      <td>PP_PREV</td>\n",
       "      <td>TA</td>\n",
       "      <td>DOD</td>\n",
       "      <td>17397.0</td>\n",
       "      <td>CDU  Angola</td>\n",
       "      <td>2015 Q2</td>\n",
       "      <td>During this period, the HIV activists have rea...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Operating Unit</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Testing</td>\n",
       "      <td>HTS_TST</td>\n",
       "      <td>TA</td>\n",
       "      <td>DOD</td>\n",
       "      <td>17397.0</td>\n",
       "      <td>CDU  Angola</td>\n",
       "      <td>2015 Q2</td>\n",
       "      <td>Monthly reports come to Luanda from all 24 VCT...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Operating Unit</td>\n",
       "      <td>Angola</td>\n",
       "      <td>Treatment</td>\n",
       "      <td>TX_CURR</td>\n",
       "      <td>TA</td>\n",
       "      <td>DOD</td>\n",
       "      <td>17397.0</td>\n",
       "      <td>CDU  Angola</td>\n",
       "      <td>2015 Q2</td>\n",
       "      <td>The FAA have not authorized sharing their care...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   Unnamed: 0 Operating Unit       Org Level Country Indicator Bundle  \\\n",
       "0           1         Angola  Operating Unit  Angola   Health Systems   \n",
       "1           2         Angola  Operating Unit  Angola   Health Systems   \n",
       "2           3         Angola  Operating Unit  Angola       Prevention   \n",
       "3           4         Angola  Operating Unit  Angola          Testing   \n",
       "4           5         Angola  Operating Unit  Angola        Treatment   \n",
       "\n",
       "   Indicator Support Type Funding Agency  Mechanism Code  \\\n",
       "0  CARE_CURR           TA            DOD         17397.0   \n",
       "1   CARE_NEW           TA            DOD         17397.0   \n",
       "2    PP_PREV           TA            DOD         17397.0   \n",
       "3    HTS_TST           TA            DOD         17397.0   \n",
       "4    TX_CURR           TA            DOD         17397.0   \n",
       "\n",
       "  Implementing Mechanism Name   Period  \\\n",
       "0                 CDU  Angola  2015 Q2   \n",
       "1                 CDU  Angola  2015 Q2   \n",
       "2                 CDU  Angola  2015 Q2   \n",
       "3                 CDU  Angola  2015 Q2   \n",
       "4                 CDU  Angola  2015 Q2   \n",
       "\n",
       "                                           Narrative  \n",
       "0  The FAA have not authorized sharing their care...  \n",
       "1  The FAA have not authorized sharing their care...  \n",
       "2  During this period, the HIV activists have rea...  \n",
       "3  Monthly reports come to Luanda from all 24 VCT...  \n",
       "4  The FAA have not authorized sharing their care...  "
      ]
     },
     "execution_count": 44,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.read_csv(\"NarrativesRaw__2024-11-14_.csv\")\n",
    "\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def get_response(user_text):\n",
    "  # Create a thread\n",
    "  thread = client.beta.threads.create()\n",
    "\n",
    "  # Add a user question to the thread\n",
    "  message = client.beta.threads.messages.create(\n",
    "    thread_id=thread.id,\n",
    "    role=\"user\",\n",
    "    content=user_text\n",
    "  )\n",
    "\n",
    "  # Run the thread\n",
    "  run = client.beta.threads.runs.create(\n",
    "    thread_id=thread.id,\n",
    "    assistant_id=assistant.id\n",
    "  )\n",
    "\n",
    "  # Looping until the run completes or fails\n",
    "  while run.status in ['queued', 'in_progress', 'cancelling']:\n",
    "    time.sleep(1)\n",
    "    run = client.beta.threads.runs.retrieve(\n",
    "      thread_id=thread.id,\n",
    "      run_id=run.id\n",
    "    )\n",
    "\n",
    "  if run.status == 'completed':\n",
    "    messages = client.beta.threads.messages.list(\n",
    "      thread_id=thread.id\n",
    "    )\n",
    "    #print(messages)\n",
    "    print(messages.data[0].content[0].text.value)\n",
    "    return messages.data[0].content[0].text.value\n",
    "\n",
    "  elif run.status == 'requires_action':\n",
    "    # the assistant requires calling some functions\n",
    "    # and submit the tool outputs back to the run\n",
    "    pass\n",
    "  else:\n",
    "    print(run.status)\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes and challenges. The positive aspects include a high number of contacts elicited per index case, a high yield of individuals testing positive, and all individuals identified as HIV positive through index testing being initiated on ART. However, there are challenges mentioned such as low rates of index contacts tested at the health facility level and the use of an outdated form that does not allow for IPV risk assessment.\n",
      "- Supporting Quotes: \"42 individuals tested positive (yield of 35.89%)\", \"all were initiated on ART during the reporting period\", \"Low rates of IC contacts tested at the HF\"\n",
      "- Score: 1 (3 positive phrases - 2 negative phrases)\n",
      "- Components: 3 positive, 2 negative, 0 mixed, 0 neutral\n",
      "- Tag(s): Health statistics, HIV testing, Data Quality Assessment, Index Case Testing, ART Initiation, Challenges in Health Services\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive outcomes, such as a high acceptance rate for index case testing services and a significant yield of new HIV diagnoses, as well as an indication of ongoing efforts to improve services without a clear impact outcome.\n",
      "- Supporting Quotes: \"243 (Male-124 Female-119) accepted these services representing 96.8%.\" \"Of the 186 contacts tested, 36 (Male-14, Female-34) were newly diagnosed with HIV, representing a yield of 25.8% (48/186).\" \"During this quarter, CDIA-AISA continued to provide virtual mentoring to improve the advice provided to Index case clients, as well as contact tracking and correct the errors identified in the revised records.\"\n",
      "- Score: 1\n",
      "- Components: 2 positive, 1 neutral, 0 negative\n",
      "- Tag(s): Health services, HIV testing, Index testing services\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive aspects, such as the recruitment and training of staff and the successful negotiation for meeting spaces, and negative aspects, such as the challenges faced with stock-outs, health issues among staff, and not reaching the quarterly target.\n",
      "- Supporting Quotes: \"contributing 26% against the annual quarterly target\", \"yield of 5.3% which is less than the 9.3% yield target\", \"Onboarding and training 96 staff in a month’s time\", \"Lack of office space at provincial level causes operational challenges\", \"There were stock-outs of Bioline tests in Benguela province\"\n",
      "- Score: -1\n",
      "- Components: 3 positive, 4 negative, numerous neutral\n",
      "- Tag(s): Health services, HIV testing, Project challenges, Staff training\n",
      "\n",
      "The narrative presents a mixed tone, with both achievements and setbacks. Positive aspects include the recruitment and training of a significant number of staff, the organization of teams, and the successful negotiation for meeting spaces. However, there are several negative points, such as not meeting the quarterly target, lower than expected yield from index testing, challenges with procuring work tools, health issues among staff, and stock-outs of testing kits. Neutral statements related to activities and plans for the future are excluded from the tone assessment. The negative aspects slightly outweigh the positive ones, leading to a mixed classification with a negative score.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes such as the high yield of HIV positive cases identified through certain testing modalities and the successful reach of the Born Free to Shine Initiative, as well as challenges like the ongoing construction at the Main Military Hospital of Luanda preventing HIV testing and inaccuracies in recording patients by modality.\n",
      "- Supporting Quotes: \"The tests resulted in a total of 412 new positive HIV cases, representing a yield of 8% (421/5124).\", \"By focusing on high-yield modalities (PITC and Index case testing), the military program is consistently achieving an HIV positive yield that is several magnitudes higher than the prevalence recorded in the SABERS study (2.5%).\", \"The CDIA-AISA recognizes that although there has been considerable improvement in the accuracy of recording patients by modality, some patients from other modalities, such as emergency and outpatient, are still being registered as VCT.\"\n",
      "- Score: 0\n",
      "- Components: 3 positive, 3 negative, 14 neutral\n",
      "- Tag(s): HIV testing, program challenges, health initiatives\n",
      "\n",
      "The entry discusses the progress and challenges of HIV testing across various sites and modalities. Positive aspects include the high yield of HIV positive cases found through targeted testing modalities and the success of the Born Free to Shine Initiative. However, there are challenges such as the inability to conduct testing at a major hospital due to construction and issues with the accuracy of recording patient data. The mixed tone reflects both the achievements and the areas that require improvement.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive aspects, such as the high linkage to ART and the use of data quality assessment tools, and negative aspects, such as challenges faced due to the closing of a health facility and limited stock of HIV rapid tests.\n",
      "- Supporting Quotes: Positive - \"the estimated linkage to ART at the 22 ICAP-supported HFs was 91.4%.\" Negative - \"Closing of CMI Benguela...has affected the number of individuals tested\" and \"Limited stock of Bioline HIV rapid test in the country.\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 1 negative, 2 neutral\n",
      "- Tag(s): Health statistics, HIV testing, Data quality, Resource issues\n",
      "\n",
      "The narrative provides a mixed tone with both positive and negative elements. The positive aspect is the high linkage to ART, especially for children under 15, which indicates a successful connection of diagnosed individuals to treatment. The negative aspects include operational challenges such as the closing of a health facility and stock-outs of HIV rapid tests, which have impacted testing numbers and the continuity of services. Neutral elements include the description of the data quality assessment process and the use of the HIV Positive Control Card, which are standard operational procedures without a specified impact on outcomes.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive and negative elements. The positive aspect is the high proxy coverage for PMTCT_EID, which is over the target at 137.4%. However, the negative aspects include challenges such as stock-outs of EID cartridges and lab consumables, and low coverage of HEI tested before 2 months of age. Additionally, the achievement of the annual target for PMTCT_EID is relatively low at 39.7%.\n",
      "- Supporting Quotes: \"Proxy coverage for PMTCT_EID was estimated at 137.4%.\" \"The number of HEI tested for HIV by 12 months (584) represents an achievement of 39.7% of the annual target for PMTCT_EID.\" \"Stock out of EID cartridges and lab consumables in Cunene and Lunda Sul.\" \"Low coverage of HEI tested before 2 months of age.\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 2 negative, 4 neutral\n",
      "- Tag(s): Health statistics, PMTCT_EID coverage, Data quality assessment, Laboratory challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive aspects, such as successful ART initiation rates in some areas, and negative aspects, such as sub-optimal linkage rates and the death of infants before receiving treatment.\n",
      "- Supporting Quotes: \"Overall, 9/13 (69.2%) HIV positive infants were initiated on ART within the reporting period,\" \"100.0% (1/1) in Benguela; 100.0% (3/3) in Cunene,\" \"55.6% (5/9) in Lunda Sul,\" \"two infants died before the EID result arrived at the HF,\" \"Sub-optimal linkage to ART for PMTCT_HEI_POS.\"\n",
      "- Score: 0\n",
      "- Components: 3 positive, 3 negative, 4 neutral\n",
      "- Tag(s): Health statistics, ART initiation, HIV treatment challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive aspects, such as high percentages of pregnant women with known HIV status and actions taken to ensure the availability of HIV test kits, and negative aspects, such as the non-operational status of a high volume health facility and challenges due to high demand and limited consultation rooms.\n",
      "- Supporting Quotes: \"99.8% had a known HIV status\", \"CMI Benguela – a high volume health facility serving pregnant women – continued to be non-operational\", \"High demand for ANC services vs. limited rooms for consultation\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 5 neutral\n",
      "- Tag(s): Healthcare services, HIV/AIDS prevention, PMTCT (Prevention of Mother-to-Child Transmission), Data quality, Facility challenges\n",
      "\n",
      "The positive aspects are the high percentages of pregnant women with known HIV status and the successful collaboration to ensure the availability of HIV test kits. The negative aspects include the non-operational status of a key health facility and the challenges faced due to high demand and limited space for consultations. Neutral information includes the data quality assessment and the age disaggregation tables, which do not inherently carry a positive or negative connotation.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive and negative elements. The positive aspect is the high percentage of TB cases with documented HIV status, which indicates effective monitoring. However, the negative aspect is the low percentage of the annual target achieved for TB cases reported.\n",
      "- Supporting Quotes: \"103 of the 104 new and relapsed TB cases reported had documented HIV results in TB registries (99%)\", \"The 104 new and recurrent TB cases registered in the 7 supported locations represented 12.5% (103/824) of the annual target of 824.\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 1 negative\n",
      "- Tag(s): Health statistics, TB/HIV co-infection monitoring\n",
      "- Classification: Positive\n",
      "- Reasoning: The text reports high coverage and documentation rates for HIV status among TB cases, which are above the threshold that would require an explanation for low coverage.\n",
      "- Supporting Quotes: \"out of 643 reported new and relapsed TB cases, 637 (99.1%) had a documented HIV status\", \"The coverage of TB_STAT by province was 99.3% (535/539) in Benguela and 98.1% (102/104) in Cunene.\"\n",
      "- Score: 2\n",
      "- Components: 2 positive, 5 neutral\n",
      "- Tag(s): Health statistics, TB/HIV co-infection management\n",
      "\n",
      "Note: The achievements of the annual targets for TB_STAT are not high, but since they are not below a threshold that would be considered low, they are not counted as negative. The rest of the text describes the process of data collection and analysis, which is neutral information.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive aspects, such as high ART coverage in certain provinces and the implementation of tools to improve data quality and patient tracking, and negative aspects, such as the low annual target achievement for PMTCT_ART and social challenges affecting ART coverage in Lunda Sul.\n",
      "- Supporting Quotes: \"This represents an achievements of 27.2% of the annual target for PMTCT_ART\", \"The coverage of PMTCT_ART by province was 100% in Benguela, Cunene, and Huambo\", \"Lunda Sul province continues to face social challenges such as stigma and discrimination towards HIV, leading to lower acceptance rates of HIV diagnosis (94.8% ART coverage).\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 5 neutral\n",
      "- Tag(s): Healthcare service delivery, PMTCT_ART coverage, Data quality, Social challenges\n",
      "\n",
      "The entry discusses the ART coverage for pregnant women living with HIV, with high coverage rates in some provinces but a lower rate in Lunda Sul due to social challenges. The overall achievement of the annual target for PMTCT_ART is low, which is a negative aspect. However, the implementation of the Positive Client Control Form and other activities to improve PMTCT care are positive steps. The mixed classification is due to the presence of both positive and negative elements in the narrative.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive aspects, such as the increase in MMD3 and MMD6 and the implementation of measures to improve data quality, and negative aspects, such as the challenges faced due to socioeconomic factors and high client volume versus low human resources.\n",
      "- Supporting Quotes: \"MM6 was provided to 19.2% of all clients on ART (+5.3% compared with COP22 Q4)\", \"Using critical fields...it was possible to automate the counting of the indicators\", \"Socioeconomic factors affecting ART adherence and retention in care\", \"High client volume vs. low HF human resources, associated with long waiting time.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 9 neutral\n",
      "- Tag(s): Treatment adherence, data quality, healthcare resource issues, patient care strategies\n",
      "\n",
      "The narrative presents a mixed tone, with positive elements such as the increase in the provision of multi-month dispensing (MMD) for clients on antiretroviral therapy (ART) and improvements in data quality assessment. However, it also highlights significant challenges, including socioeconomic factors impacting ART adherence and retention in care, as well as the discrepancy between high client volume and low human resources at health facilities. The steps taken to address these challenges are mentioned, but the overall tone remains mixed due to the presence of these unresolved issues.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as active support to treatment sites and the addition of a new integrated HIV service, and negative elements, such as the decline in the number of patients currently on treatment and the issues with duplicates and lost to follow-up patients.\n",
      "- Supporting Quotes: \"A treatment site, the Hospital Militar Região Norte Uíge, was included for DoD support, to replace BRIFE, a site in the Military Region of Luanda.\" \"The program continues with the deduplication and cleaning exercise of the Military Hospital's database and clinical records.\" \"The number of TX_CURR continued to decline from 7,693 in fiscal year 23Q4 to 5,824 in the 24Q1 fiscal year.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 5 neutral\n",
      "- Tag(s): Healthcare support, patient treatment, data quality issues\n",
      "- Classification: Negative\n",
      "- Reasoning: The text primarily discusses issues related to patients not maintaining clinical contact, patient deaths, and challenges in tracking and retaining patients in treatment.\n",
      "- Supporting Quotes: \"a total of 502 patients...had no clinical contacts for more than 28 days\", \"16 of 502 (3.2%) patients died\", \"patients interrupted treatment\", \"patients...do not obtain authorization to travel to collect their medicines.\"\n",
      "- Score: -4\n",
      "- Components: 0 positive, 4 negative, 0 mixed, 0 neutral\n",
      "- Tag(s): Patient retention, treatment interruption, patient death, health service challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive elements, such as the implementation of a new client registry and the ongoing efforts to improve data quality and client tracing, and negative elements, such as the challenges faced in reporting TX_ML, structural issues affecting treatment continuity, and the poor quality of vital registries.\n",
      "- Supporting Quotes: \"ICAP has been implementing the revised IIT Improvement Action Plan\", \"No client refused ART\", \"ICAP M&E team has developed and is implementing a new client registry\", \"Silence transfer and deaths at community level without notification at the HF level for appropriate registration continue to be important statistical challenges\", \"The quality of vital registries in Angola is still poor\".\n",
      "- Score: 0\n",
      "- Components: 3 positive, 3 negative, numerous neutral\n",
      "- Tag(s): Data quality, treatment continuity, health facility challenges, client registry, mortality data\n",
      "\n",
      "The narrative presents a mixed tone, with positive aspects such as the implementation of the revised IIT Improvement Action Plan and the development of a new client registry aimed at improving data quality and tracking of clients. These efforts indicate a strategic change and a potential positive impact on the program. However, there are also significant challenges mentioned, such as structural issues not being addressed by the action plan, the ongoing problem of silent transfers and unreported deaths, and the poor quality of vital registries. These negative aspects highlight difficulties in accurately reporting and managing TX_ML cases. The mention of high client load versus low human resources and the social determinants of health affecting ART continuity are additional challenges that are acknowledged but not elaborated upon in this excerpt.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as a high percentage of individuals enrolled on ART shortly after diagnosis, and negative elements, such as patients not being linked to ART enrollment and not meeting the annual target.\n",
      "- Supporting Quotes: \"385 of 412 were enrolled on ART, representing 93.4% (385/412)\", \"27 of 412 individuals with HIV were not linked to ART enrollment at the end of the reporting period (6.5%)\", \"The 273 patients recently initiated on ART represent 25% (273/1,092) of our annual target of 1,092.\"\n",
      "- Score: 1 (2 positive phrases - 1 negative phrase)\n",
      "- Components: 2 positive, 1 negative, 5 neutral\n",
      "- Tag(s): HIV treatment, ART enrollment, healthcare service delivery\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive elements, such as the initiation of individuals on ART and the high linkage rate, and a negative element, which is the low achievement of the annual target.\n",
      "- Supporting Quotes: \"This represents an achievement of 20.6% of the annual target for this indicator.\" \"A total of 1,185 out of 1,196 clients identified as HTS_TST_POS during COP23 Q1 were initiated on ART, representing a linkage rate of 91.4%.\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 1 negative, 8 neutral\n",
      "- Tag(s): Health statistics, ART initiation, Data quality assessment\n",
      "\n",
      "The narrative provides a detailed account of the number of individuals newly initiated on ART, the distribution across different regions and age groups, and the gender distribution of clients. The positive aspect is the high linkage rate of 91.4% from HTS_TST_POS to ART initiation. However, the achievement of only 20.6% of the annual target for this indicator is a negative aspect, indicating that the program is behind its goal. The data quality assessment process is described neutrally, without indicating any specific positive or negative outcomes. The absence of reported challenges and steps to address them is neutral as it does not provide information on the impact or outcomes.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as the successful restart of ART for patients who experienced an interruption, and negative elements, such as the challenges in tracking patients due to lack of contact information.\n",
      "- Supporting Quotes: \"232 patients [...] were successfully restarted on ART\" and \"94% of patients who have stopped treatment do not have contact details and therefore cannot be contacted.\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 1 negative\n",
      "- Tag(s): Patient treatment, healthcare challenges, patient tracking\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes, such as the successful restart of ART clients on treatment and the effectiveness of phone calls in tracing clients, as well as challenges related to the treatment program and data quality.\n",
      "- Supporting Quotes: \"a total of 2,652 ART clients [...] were successfully restarted on ARVs\", \"phone calls contributed to the return to HF of 920 (34.7%) clients\", \"maintaining an equilibrium between clients who experienced IIT [...] continues to be unpredictable and challenging\", \"This has resulted in a less than optimal increase in the number of TX_CURR across the reporting quarters.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 5 neutral\n",
      "- Tag(s): Healthcare outcomes, patient tracking, data quality challenges\n",
      "\n",
      "The narrative presents a mixed tone with both positive and negative aspects. On the positive side, it reports the successful reinitiation of ART for clients who had interrupted treatment and the effectiveness of phone calls in bringing clients back to health facilities. However, it also mentions challenges in maintaining a balance between clients who experienced interruptions in treatment and those who successfully restarted, which has led to a less than optimal increase in current treatment numbers. Additionally, the inclusion of clients who are not eligible for viral load tests negatively impacts the viral load coverage rate, presenting another challenge. The data quality assessment and the efficacy of phone calls are neutral information, providing context without a qualitative assessment of impact.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes such as high percentages of viral load (VL) suppression and achievements close to the annual targets, as well as challenges like low VL coverage and stock out of cartridges.\n",
      "- Supporting Quotes: \"94.0% (7,115) had a suppressed VL result\", \"achievements of 83.2% (D) and 82.3% (N) for the annual targets\", \"Low VL coverage: Estimates for COP23 Q1 show that overall VL coverage is 43.9%\", \"stock-out of cartridges for mPIMA VL in both Cunene and Lunda Sul.\"\n",
      "- Score: 0\n",
      "- Components: 4 positive, 4 negative, 0 mixed, 0 neutral\n",
      "- Tag(s): Health statistics, ART regimen impact, Data quality, Resource issues\n",
      "\n",
      "The narrative presents a mixed tone with both positive and negative aspects. The positive aspects include the high percentage of clients with suppressed viral loads and the achievements of annual targets for TX_PVLS, which are close to 100%. The negative aspects are the challenges faced, such as low viral load coverage and stock out of cartridges, which are significant issues impacting the program's effectiveness. The positive and negative components balance each other out, resulting in a mixed classification.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive and negative elements. The positive aspect is the high percentage of viral suppression among those tested, indicating effective treatment. The negative aspect is the decline in viral load (VL) coverage and the lack of reagents, which is expected to cause a further decline in coverage.\n",
      "- Supporting Quotes: \"1,627, representing 86.6% (1,627/1,877), indicated viral suppression\", \"VL coverage fell from 23% reported during FY23Q4 to 23% this quarter\", \"Our coverage will continue to decline because the military program did not receive the reagents allocated in FY23 and to date we have not received this allocation in FY24.\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 1 negative\n",
      "- Tag(s): Viral load testing, treatment effectiveness, resource issues\n",
      "- Classification: Positive\n",
      "- Reasoning: The text reports successful follow-up visits and reinitiation of PrEP treatment, with a high percentage of individuals continuing treatment and negative HIV test results. Additionally, the implementation of a robust appointment and follow-up system is mentioned as contributing to the success.\n",
      "- Supporting Quotes: \"None of the beneficiaries received a positive HIV test result, all received a negative HIV test result.\" \"At least 70% of those returning for PrEP are expected to continue longer than 3 months.\" \"For FY24, 2361 individuals were continuing oral PrEP, which is 155% of Bummhi’s total FY24 target, 1520.\"\n",
      "- Score: 3\n",
      "- Components: 3 positive, 0 negative, 0 mixed, 0 neutral\n",
      "- Tag(s): Health outcomes, PrEP treatment, HIV prevention, Data quality assurance\n",
      "\n",
      "Excluded Phrases:\n",
      "- Plans for the future: \"The strategies to scale up PrEP_ CT in the upcoming implementation period include the following...\"\n",
      "- Regular duties without impact: \"A line list is being updated every day...\" \"Routine Data Quality Assurance activities are employed to ensure that data reported matches with records facilities.\" \"Bummhi supported the implementation of a robust appointment and follow-up system for PrEP clients...\" \"Bummhi also supported the development of the PrEP communication strategy...\"\n",
      "- Classification: Positive\n",
      "- Reasoning: The text reports successful follow-up visits and reinitiations of PrEP treatment, with all beneficiaries receiving a negative HIV test result, indicating effective prevention. The mention of remedial action for data quality assurance also suggests proactive measures to maintain data integrity.\n",
      "- Supporting Quotes: \"632 number of individuals...returned for a follow- up visit or reinitiated PrEP treatment\", \"0 beneficiaries received a positive HIV test result, and 632 beneficiaries received a negative HIV test result\", \"Where gaps are found, remedial action is done swiftly before the quarter report can be compiled.\"\n",
      "- Score: 3\n",
      "- Components: 3 positive, 0 negative, 0 mixed, 4 neutral\n",
      "- Tag(s): Health outcomes, Data quality assurance\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive outcomes, such as a high number of individuals returning for follow-up visits and a negative HIV test result for all beneficiaries, as well as challenges, including reasons why clients stop using PrEP.\n",
      "- Supporting Quotes: \"EpiC reached 580 individuals...who returned for a follow-up visit or reinitiated PrEP treatment\", \"all 580 beneficiaries received a negative HIV test result\", \"EpiC PrEP continuation rate is around 80%\", \"Clients who stop using PrEP cite the following common reasons: they are no longer at risk, they do not want to take medication when they are not sick, pill fatigue and side effects such as weight gain\"\n",
      "- Score: 0\n",
      "- Components: 3 positive, 3 negative, 2 neutral\n",
      "- Tag(s): Health services, PrEP continuation, Data quality assurance, Client retention challenges\n",
      "- Classification: Positive\n",
      "- Reasoning: The text reports on successful outcomes such as the number of individuals continuing on PrEP, which exceeds the target, and the implementation of systems to support clients.\n",
      "- Supporting Quotes: \"Bummhi reached 2361 individuals who continued on PrEP\", \"2361 individuals were continuing on oral PrEP, which is 155% of Bummhi’s total FY24 target\", \"Bummhi supported the implementation of a robust appointment and follow-up system for PrEP clients\"\n",
      "- Score: 3\n",
      "- Components: 3 positive, 0 negative, 0 mixed, 4 neutral\n",
      "- Tag(s): Health program success, PrEP continuation, Target achievement\n",
      "- Classification: Negative\n",
      "- Reasoning: The text primarily discusses underachievement in the target goals for PrEP enrollment and the challenges faced in reaching the desired numbers.\n",
      "- Supporting Quotes: \"The results are under achievement against quarter target of 25%, at 19% across all EpiC sites for both FSW and MSM.\" \"PrEP uptake was lower among MSM at 13.9% (299/2156) and FSW at 23% (501/2141).\" \"The results are attributed to late implementation in Q1, some referred clients declined PrEP when they reach the nurses, while some do not perceive themselves at risk despite their risk behavior.\"\n",
      "- Score: -3\n",
      "- Components: 3 negative, 2 neutral\n",
      "- Tag(s): Health statistics, PrEP enrollment, Target underachievement\n",
      "\n",
      "Excluded: Plans for the future (\"In Q2 Peer Outreach Workers will be trained...\") and regular duties (\"Data verification and quality monitoring exercise was conducted...\").\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive elements, such as exceeding the target for new enrollments on oral PrEP and the successful use of social media and collaborations for enrollments, and negative elements, such as a low percentage of clients returning for their 1-month review.\n",
      "- Supporting Quotes: \"415 of individuals were newly enrolled on oral PrEP, which is 155% of Tebelopele’s total FY24 Q1 target (311).\" \"21% (102/481) of those who newly initiated PrEP returned for their 1 month review.\"\n",
      "- Score: 1\n",
      "- Components: 2 positive, 1 negative, 5 neutral\n",
      "- Tag(s): Health statistics, HIV prevention, program performance\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive aspects, such as successful enrollments and implementation of programs, and negative aspects, such as challenges with same-day performance and client-related issues not leading to initiation.\n",
      "- Supporting Quotes: Positive - \"Bummhi enrolled 2035 new individuals on oral PrEP\", \"Universal screening for substantial risk was implemented\", \"Through continued mentorship, districts like Serowe, Palapye, Boteti and Kweneng East now run PrEP programs that are GOB led hence their wide coverage and high initiation rates.\" Negative - \"some facilities have designated PrEP initiation days which negatively impacts same day performance\", \"For clients not initiated due to client related reasons, Bummhi provides risk reduction and barriers counseling including re-offering clients PrEP.\"\n",
      "- Score: 0\n",
      "- Components: 4 positive, 4 negative\n",
      "- Tag(s): Health program implementation, HIV prevention, PrEP enrollment, mentorship and training, service decentralization, performance challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as the achievement of a high percentage of the quarterly target, and a negative element, which is the decline of PrEP initiation by some clients perceived at risk.\n",
      "- Supporting Quotes: \"The FY24 Q1 reach translates into 92.9% of the quarterly target (1385).\" \"Some clients who were perceived at risk have declined PrEP initiation.\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 1 negative, 2 neutral\n",
      "- Tag(s): Health statistics, HIV prevention, program outreach\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as successful linkage of HIV-positive clients to ART and no moderate or severe adverse events reported, and negative elements, such as not meeting the annual target for VMMCs and low performance in some districts.\n",
      "- Supporting Quotes: \"representing 23% of the annual target\", \"2348 (95%) of those circumcised were circumcised with valid HIV Testing results\", \"No moderate or severe AEs were reported in Q1\", \"The district’s performances against their annual target are as follows; Kweneng East 453/1532 (29.6%), Mahalapye 338/1419 (23.8%), Serowe 317/1137 (27.9%), Gaborone 352/1874 (18.8%), Kgatleng 125/901 (13.9%), South East 95/809 (11.7%), Bobirwa 258/855 (30.2%), Palapye 139/1098 (12.7%), Moshupa 241/310 (77.7%) and Kanye 159/765 (20.8%).\"\n",
      "- Score: 0\n",
      "- Components: 3 positive, 3 negative, 4 neutral\n",
      "- Tag(s): Health services performance, HIV/AIDS management, VMMC program\n",
      "- Classification: Positive\n",
      "- Reasoning: The text reports high achievement percentages, successful follow-ups, valid HIV testing results, and no reported adverse events, all of which contribute to a positive tone.\n",
      "- Supporting Quotes: \"a total of 2477 VMMCs were conducted from 25 sites, translating into 93% of the FY23, Q1 target\", \"all the 2477 (100%) circumcised males returned for follow-up within 48 hours\", \"2,348/2477 (95%) of those circumcised had valid HIV testing results\", \"All the new HIV New Positives were linked and initiated on ART\", \"No moderate or severe AEs were reported in Q1\", \"This achievement is attributed to the ongoing telephonic and physical follow-up of clients across all sites.\"\n",
      "- Score: 6\n",
      "- Components: 6 positive, 0 negative, 0 mixed, 0 neutral\n",
      "- Tag(s): Health program performance, HIV testing, VMMC achievements\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as the full coverage of Partner Notification Services at all facilities and the number of clients offered index testing, and negative elements, such as the delays in recruitment affecting PNS activities and the low percentage of eligible contacts tested for HIV.\n",
      "- Supporting Quotes: \"PEPFAR/BOTSWANA offered Partner Notification Services at 23 GOB sites (100%) of its facilities\", \"delays in recruitment for the current COP, which resulted in the absence of HCAs in these health facilities until mid-November\", \"54 (24%) of them were tested for HIV, representing 3% progress to annual target.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 3 neutral\n",
      "- Tag(s): Health services, Staffing issues, HIV testing\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes, such as high acceptance rates for index testing and successful linkage to care, as well as areas where targets were not fully met, indicating a mixed tone.\n",
      "- Supporting Quotes: \"2095 (100%) received their test results, and 439 were newly identified HIV positive\", \"409 (93%) were linked to care\", \"These FY24 Q1 results represent (24%) of the FY24 TA target of 1800\", \"Most newly identified males postponed initiation on treatment compared to females\", \"The remaining six are still being followed to access partner notification services.\"\n",
      "- Score: 1 (5 positive phrases - 4 negative phrases)\n",
      "- Components: 5 positive, 4 negative, 0 mixed, 0 neutral\n",
      "- Tag(s): Health services, HIV testing, patient care linkage, treatment initiation\n",
      "\n",
      "The narrative presents a mixed tone with several positive aspects such as the 100% offering of index testing services at supported facilities, high acceptance rates of index testing, a high percentage of contacts tested and receiving results, and a high percentage of those testing positive being linked to care. However, there are negative aspects as well, such as the FY24 Q1 results representing only 24% of the target, males postponing treatment initiation, and some individuals still being followed for partner notification services. The positive aspects are slightly more numerous than the negative, but the negative aspects are significant enough to prevent a purely positive classification.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive outcomes and challenges faced during the reporting period. The successful aspects include a high acceptance rate for index testing, a high percentage of contacts tested, and a high linkage to care for those who tested positive. However, there are also several challenges mentioned that negatively impacted the index testing services.\n",
      "- Supporting Quotes: \"Of those identified, 637 accepted index testing,\" \"1274 (87%) were tested,\" \"171 were HIV+,\" \"167 (98%) were linked to care and treatment,\" \"slow process in handing over of index lists by facilities,\" \"Registers not fully updated,\" \"Some of the sexual contacts delayed to be tested,\" \"some clients could not be located,\" \"lack of documentation on referrals for prevention services,\" \"inconsistent follow up feedback of contacts tested.\"\n",
      "- Score: 0\n",
      "- Components: 4 positive, 4 negative\n",
      "- Tag(s): Health services, HIV testing, program challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes, such as the initiation of treatment for newly identified positives and the acceptance of index testing, as well as challenges, like difficulties in reaching one-time clients and issues with differentiating MSM in the referral process.\n",
      "- Supporting Quotes: \"Of the 10 newly identified positives, 90% (9/10) were initiated on treatment.\" \"EpiC continues to face challenges with reaching the one-time clients of FSW.\" \"There is a challenge differentiating MSM who are index clients of MSM.\"\n",
      "- Score: 0\n",
      "- Components: 3 positive, 3 negative, 4 neutral\n",
      "- Tag(s): Health services, HIV treatment, Index testing challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes, such as high acceptance rates for index testing and successful linkages to care, as well as challenges like low testing rates of elicited sexual contacts and difficulties reaching partners of non-citizens. The improvements and strategies implemented to address challenges are also mentioned.\n",
      "- Supporting Quotes: \"848 (97%) accepted index testing\", \"355 (92 %) were linked to care\", \"low testing rates of elicited sexual contacts\", \"partners to non-citizens were a challenge to reach\", \"Improvement was observed in numbers of facilities actively implementing index testing; improved elicitation and testing rates of elicited contacts as well as the yield for index modality.\"\n",
      "- Score: 1 (3 positive phrases, 2 negative phrases)\n",
      "- Components: 3 positive, 2 negative, 0 mixed, 0 neutral\n",
      "- Tag(s): Healthcare services, HIV testing, program challenges, patient care linkage, performance improvement\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive outcomes, such as 100% linkage to care for those who tested positive, and challenges encountered in the process, such as contacts being reluctant to access testing services.\n",
      "- Supporting Quotes: \"Of those who tested positive, 12 (100%) were linked to care.\" \"Challenges encountered during this process are as follows: Contacts reached reluctant to access testing services.\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 1 negative, 6 neutral\n",
      "- Tag(s): Health services, HIV testing, patient care, challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive outcomes and challenges faced during the reporting period. The high acceptance rate for index testing and the high percentage of individuals tested and linked to treatment are positive. However, the challenges encountered and the lower than target performance indicate negative aspects.\n",
      "- Supporting Quotes: \"922 individuals were identified and offered index testing. 901 accepted...1028 (99%) were tested and received their test results. 60 were (88%) linked to treatment.\" \"The results represent (56%) of the FY24 Q1 index testing target of 1825.\" \"Several challenges have been encountered in the process of scaling up index testing.\"\n",
      "- Score: 0\n",
      "- Components: 3 positive, 3 negative, 4 neutral\n",
      "- Tag(s): Health services, HIV testing, Treatment linkage, Program challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as the provision of tests and the completion of viral load testing, and a negative element, which is the achievement of only 62% of the target.\n",
      "- Supporting Quotes: \"75 newly diagnosed HIV-positive clients\", \"All the RTRI recent sample were sent to the lab for viral load testing and results were provided\", \"These results represent 62% of the total Tebelopele FY24 DSD target of 121.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 1 negative, 2 neutral\n",
      "- Tag(s): Health statistics, HIV testing, program performance\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as successful testing and confirmation of recent infection, and negative elements, such as partners not meeting requirements and low achievement percentages.\n",
      "- Supporting Quotes: \"1 (25%) test was RTRI recent infection\", \"Recency testing achievement was 9%\", \"Three partners were assessed in the reporting period and did not meet requirements for Recency testing.\"\n",
      "- Score: -1\n",
      "- Components: 1 positive, 2 negative, 5 neutral\n",
      "- Tag(s): Health statistics, HIV testing, program assessment\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as the high acceptance rate of RTRI and successful adherence to quality standards, and negative elements, such as challenges in offering the test and missing recency testing among some newly identified positives.\n",
      "- Supporting Quotes: \"299 (91%) accepted\", \"they all achieved composite scores of 80% or more\", \"suboptimal offering of the test to clients\", \"missing recency testing among some newly identified positives.\"\n",
      "- Score: 0\n",
      "- Components: 3 positive, 3 negative, 5 neutral\n",
      "- Tag(s): Health services, quality standards, performance monitoring\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive elements, such as the implementation of testing and training of healthcare workers, and negative elements, such as the decline in participation and the issue with barcode stock affecting testing.\n",
      "- Supporting Quotes: \"RTRI results for FY24 Q1 are the following: 40 (11.6%) tests were RTRI recent infection, and 304 (88.4%) tests were RTRI long-term infection.\" \"A noticeable decline rate in participation was observed among newly identified PLHIV.\" \"Only 120 were tested for RTRI while 22 could not be tested due to barcodes being out of stock.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 4 neutral\n",
      "- Tag(s): Health statistics, Testing implementation, Resource issues, Training and support\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive aspects, such as the number of individuals tested and the success rate of linkage to treatment, and negative aspects, such as challenges in achieving the indicator and low linkage rates.\n",
      "- Supporting Quotes: \"These FY24 Q1 results represent (69%) of the FY24 DSD OR TA OR TA target of (4289)\", \"127 (88%) of those eligible were linked to treatment\", \"challenge in achieving this indicator is attributed to several factors including low positivity rate\", \"low linkage rates.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 5 neutral\n",
      "- Tag(s): HIV testing, treatment linkage, health service challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive aspects, such as meeting assessment standards and successful training of community health workers, and negative aspects, such as staffing shortages, declined tests, and pending viral load tests.\n",
      "- Supporting Quotes: \"The two districts met the standards of the assessment\", \"shortage of staffing and late training of field staff offering recency testing only 85 were offered RTRI with 42 declining the test\", \"All the 2 whom received the VL test were confirmed to be recent infections during VL test.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 5 neutral\n",
      "- Tag(s): Health services assessment, staffing issues, HIV testing\n",
      "- Classification: Negative\n",
      "- Reasoning: The text indicates a low achievement towards the annual target.\n",
      "- Supporting Quotes: \"These results represent 6% achievement towards annual target.\"\n",
      "- Score: -1\n",
      "- Components: 0 positive, 1 negative, 0 mixed, 1 neutral\n",
      "- Tag(s): Health statistics, HIV testing performance\n",
      "- Classification: Positive\n",
      "- Reasoning: The text reports successful distribution and usage of HIV self-test kits, effective linkage to care for those who tested positive, and no challenges in tracking linkage for repeat testing.\n",
      "- Supporting Quotes: \"1405 number of HIV self-test kits to individuals\", \"Of those who tested positive all (100%) were linked to care\", \"During this reporting period, there were no challenges reported with tracking linkage of individuals for repeat testing, as 100% of them were confirmed to be HIV positive.\"\n",
      "- Score: 3\n",
      "- Components: 3 positive, 0 negative, 0 mixed, 4 neutral\n",
      "- Tag(s): Health services delivery, HIV testing, patient care linkage\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive elements, such as the high number of self-test kits distributed and a significant percentage of individuals linked to care, as well as negative elements, such as the lower linkage to care in one of the programs and the fact that some test kits returned unused.\n",
      "- Supporting Quotes: \"Of those who tested positive 47(75%) were linked to care\", \"Of those who tested positive 9 (53%) were linked to care\", \"37 test kits returned unused\"\n",
      "- Score: 0\n",
      "- Components: 3 positive, 3 negative, 14 neutral\n",
      "- Tag(s): HIV testing, healthcare outreach, data verification, high-risk population targeting\n",
      "\n",
      "The narrative provides a detailed account of the distribution and usage of HIV self-test kits across different programs and populations. The positive aspects include the high number of kits distributed, the use of directly assisted contexts to ensure proper usage, and the successful linkage of a significant percentage of individuals who tested positive to care. However, there are negative aspects as well, such as the lower percentage of linkage to care in the key populations program and the unused test kits in the PEPFAR TA-supported sites. Neutral information includes the distribution demographics and the strategies employed for distribution, which do not inherently carry a positive or negative connotation.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text includes both the progress made in distributing HIV self-test kits and the challenges faced due to rationing, which affected the total distribution numbers.\n",
      "- Supporting Quotes: \"These results represent 40% progress towards annual target.\" \"Although this has been addressed, it affected the total number of HIVST kits distributed.\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 1 negative\n",
      "- Tag(s): Health program progress, resource distribution challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes such as successful distribution of HIV self-test kits, linking positive cases to care, and improvements in return of results and yield, as well as challenges like low distribution to key populations and restrictions on testing certain groups.\n",
      "- Supporting Quotes: \"168 (5 %) were HIV+... 156 (93 %) were linked to care\", \"HIVST distribution for KP has been low\", \"improvement in return of results from 13% to 37%; with an improved yield from 2% to 3% and 100% of the newly diagnosed being successfully linked and initiated to ARVs\", \"Bummhi has not been able to use HIVST to test pediatrics\", \"the use of HIVST for PrEP clients has not been approved by the Ministry of Health.\"\n",
      "- Score: 1 (4 positive phrases - 3 negative phrases)\n",
      "- Components: 4 positive, 3 negative, 0 mixed, 0 neutral\n",
      "- Tag(s): HIV testing, healthcare strategy, patient care linkage, population health management\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as the high percentage of self-test kits used in a directly assisted context and the contribution to case finding, and negative elements, such as the lower percentage of individuals who were linked to care after testing positive.\n",
      "- Supporting Quotes: \"99% (685/ 691) self-test kits were used in a 'directly assisted' context\", \"HIVST contributed 12% (17 out 140) to case finding\", \"Of those who tested positive 9 (53%) were linked to care.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 4 neutral\n",
      "- Tag(s): HIV testing, health statistics, care linkage\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive elements, such as the distribution of self-test kits and the linkage to care for those who tested positive, and negative elements, such as the challenge of not returning test results to the facility.\n",
      "- Supporting Quotes: \"Of the tests distributed, 600 results were known/returned, and 19 (3%) were HIV+. Of those who tested positive 12 (63%) were linked to care.\" and \"It is evident that clients prefer unassisted testing although it poses the challenge of not returning test results to the facility.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 3 neutral\n",
      "- Tag(s): HIV self-testing, health service delivery, patient care linkage, data reporting challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive elements, such as the successful distribution and usage of HIV self-test kits and linkage to care for those who tested positive, and negative elements, such as the challenge of non-reactive results and community preference for diagnostic testing.\n",
      "- Supporting Quotes: \"Of those who tested positive 9 (75%) were linked to care\", \"One notable challenge that emerged was the high number of tests that yielded non-reactive results and decline of HIVST by community members who prefer diagnostic testing\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 1 negative, 6 neutral\n",
      "- Tag(s): HIV testing, healthcare outreach, community health challenges\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes, such as the linkage rate and the number of individuals tested, as well as an indication of a lower-than-target performance.\n",
      "- Supporting Quotes: \"These FY24 Q1 results represent (13%) of the FY24 DSD target of (9767).\" \"The linkage rate was at 91%.\" \"Data discrepancies identified were within the acceptable limit of =/- 5%.\"\n",
      "- Score: 1\n",
      "- Components: 3 positive, 1 negative, 6 neutral\n",
      "- Tag(s): HIV testing, community health, data quality assurance\n",
      "\n",
      "The entry provides a mixed tone. On the positive side, it highlights successful strategies in HIV testing and the high linkage rate to treatment, as well as the absence of data collection challenges and acceptable data quality levels. However, the fact that the results represent only 13% of the target suggests that the program is behind its goals, which is a negative aspect. The positive aspects include the linkage rate of 91% and the data discrepancies being within acceptable limits. The negative aspect is the low achievement against the target. Neutral information includes the description of the testing strategies and the number of individuals tested, which does not inherently carry a positive or negative connotation without further context on expectations or goals.\n",
      "- Classification: Positive\n",
      "- Reasoning: The entry highlights the achievement of surpassing the target for HIV testing and the implementation of processes to improve testing accuracy and efficiency.\n",
      "- Supporting Quotes: \"These FY24 Q1 results represent (232%) of the FY24 DSD target of 2418.\" \"All clients who are diagnosed HIV positive, go through a verification test before ART initiation.\"\n",
      "- Score: 2\n",
      "- Components: 2 positive, 0 negative, 0 mixed, 5 neutral\n",
      "- Tag(s): Health statistics, HIV testing, Data quality\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes, such as the high rate of ART initiation and the improvement in testing rates, and challenges, such as the low health-seeking behaviors in males and the low testing of children of high-risk populations.\n",
      "- Supporting Quotes: \"100% of HIV infected clients were verified prior to ART initiation\", \"proportionally low numbers of males as compared to their female counterparts\", \"Testing of elicited children of high risk populations continues to be low\", \"testing rates of elicited partners increasing from 32% to 45%\", \"overall positivity yield improving from 0% to 8% post intervention\"\n",
      "- Score: 1 (4 positive phrases, 3 negative phrases)\n",
      "- Components: 4 positive, 3 negative, 0 mixed, 0 neutral\n",
      "- Tag(s): HIV testing, ART initiation, health-seeking behavior, pediatric HIV testing, PrEP retention, mentorship programs\n",
      "\n",
      "The entry discusses the successful HIV testing and counseling services provided, with a high rate of ART initiation and verification of HIV-infected clients before treatment. However, it also mentions challenges such as low health-seeking behaviors in males and low testing rates in children of high-risk populations. Positive developments include the improvement in testing rates and overall positivity yield after interventions. The mixed tone reflects both the achievements and the areas that require further attention.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The text contains both positive and negative elements. The expansion of testing sites is positive, but the report also indicates that the targets for testing are not being fully met, and there is a decline in the positivity rate compared to the previous quarter. Additionally, the implementation delay is a negative aspect.\n",
      "- Supporting Quotes: \"These results represent 59% for 15+ and 10% for <15 towards the annual target.\" \"The overall positivity rate for this quarter is 1.9% and has declined as compared to the previous quarter.\" \"Implementation for the quarter started mid-November due to delayed hiring processes.\"\n",
      "- Score: 0\n",
      "- Components: 1 positive, 1 negative, 3 neutral\n",
      "- Tag(s): HIV testing, program implementation, health targets\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive outcomes, such as high percentages of individuals initiated to ART and successful implementation of testing services, and negative aspects, such as challenges with community testing services and M&E challenges.\n",
      "- Supporting Quotes: \"These FY24 Q1 results represent (92%) of the FY24 DSD OR TA OR TA target of 4824.\" \"A total of 323 (98%) were successfully initiated to ART with 271 (84%) initiating on same day of diagnostic HIV test.\" \"slow process in handing over of index lists by facilities\" \"insufficient documentation on referrals for prevention services\"\n",
      "- Score: 0\n",
      "- Components: 4 positive, 4 negative\n",
      "- Tag(s): HIV testing, ART initiation, M&E challenges, community health services\n",
      "\n",
      "The narrative presents a mixed tone with both achievements and challenges. The positive aspects include the high percentage of the target achieved for HIV testing, the high rate of ART initiation, and the successful implementation of index testing services. However, there are significant challenges mentioned, such as the slow process in handing over index lists, registers not being fully updated, and insufficient documentation and follow-up for clients tested by community health workers. These challenges balance out the positive outcomes, resulting in a mixed classification.\n",
      "- Classification: Mixed\n",
      "- Reasoning: The entry contains both positive aspects, such as the number of individuals tested and the success rate of linkage to treatment, and negative aspects, such as challenges in achieving the indicator due to low positivity and linkage rates.\n",
      "- Supporting Quotes: \"These FY24 Q1 results represent (69%) of the FY24 DSD OR TA OR TA target of (4289)\", \"127 (88%) of those eligible were linked to treatment\", \"challenge in achieving this indicator is attributed to several factors including low positivity rate among high-risk clients tested across all modalities, declining positivity rates in supported districts and low linkage rates.\"\n",
      "- Score: 0\n",
      "- Components: 2 positive, 2 negative, 5 neutral\n",
      "- Tag(s): HIV testing, treatment linkage, health services challenges\n",
      "- Classification: Positive\n",
      "- Reasoning: The entry highlights several achievements and positive outcomes in HIV testing and counseling services, including exceeding targets, high linkage rates to treatment, and effective data management systems.\n",
      "- Supporting Quotes: \"cumulatively the OU has achieved 145.76% of target\", \"90% were linked to treatment\", \"The linkage rate was at 91%\", \"These FY2024 Q1 results represent 25% of the FY2024 TA target of 4017.\"\n",
      "- Score: 5\n",
      "- Components: 5 positive, 0 negative, 0 mixed, 0 neutral\n",
      "- Tag(s): Health services performance, HIV testing, Data management\n",
      "\n",
      "The narrative provides a comprehensive overview of the HIV testing and counseling services, with a focus on the achievements and positive outcomes. The exceeding of quarterly targets, high rates of linkage to treatment, and effective data verification and deduplication processes all contribute to a positive tone. The entry also mentions the successful implementation of community and facility-based testing approaches, as well as the use of electronic medical records (EMRs) to ensure accurate linkage to treatment. The overall tone is positive, with a focus on the successful outcomes and effective strategies implemented during the reporting period.\n"
     ]
    }
   ],
   "source": [
    "filtered_df = df[(df['Period'].str.contains(\"2024\"))].copy() \n",
    "\n",
    "# Loop through each Narrative and process\n",
    "for index, row in filtered_df.iterrows():\n",
    "    narrative = row['Narrative']\n",
    "    response = get_response(narrative)  # Replace with your actual API call\n",
    "\n",
    "    # Parse the components from the response\n",
    "    #value = response['data'][0]['content'][0]['text']['value']\n",
    "    components = {}\n",
    "    for line in response.splitlines():\n",
    "        if \": \" in line:  # Check for key-value separator\n",
    "            key, val = line.split(\": \", 1)\n",
    "            components[key.strip(\"- \")] = val.strip()\n",
    "\n",
    "    # Add components to the corresponding row in the filtered DataFrame\n",
    "    for key, val in components.items():\n",
    "        filtered_df.loc[index, key] = val  # Add as new columns\n",
    "\n",
    "    time.sleep(30)  # Respect rate limits if necessary\n",
    "\n",
    "filtered_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 98,
   "metadata": {},
   "outputs": [],
   "source": [
    "filtered_df.to_csv(\"narratives_sentiments.csv\")"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
